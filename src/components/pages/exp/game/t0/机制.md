# 游戏机制设计文档

## 1. 核心概念
本游戏建立在扑克牌型比拼的基础上，结合了 RPG 的战斗属性（攻防、Buff、状态）。

### 基础规则
- **牌池**: 双方各自拥有一套独立的标准扑克牌（52 张，无大小王）。
  - 游戏开始时洗牌。
  - 牌堆耗尽时，将弃牌堆洗牌后重新作为牌堆。
- **手牌**: 双方补牌至 8 张（具体数值视平衡调整）。

---

## 2. 牌型与倍率
倍率计算基于概率模型：`q = ceil(log2(x+1))`，其中 x 为该牌型出现的赔率。

### 牌型表
| 分类         | 牌型名称   | 构成要求          | 倍率 (q 值) | 说明         |
|:-------------|:-----------|:------------------|:------------|:-------------|
| **基础牌型** | **单张**   | 任意 1 张牌       | **1**       | 基础攻击手段 |
|              | **对子**   | 2 张点数相同      | **2**       |              |
|              | **两对**   | 2 组对子          | **3**       |              |
| **高级牌型** | **三条**   | 3 张点数相同      | **4**       |              |
|              | **顺子**   | 5 张连续点数      | **5**       |              |
|              | **同花**   | 5 张相同花色      | **5**       |              |
|              | **三带二** | 3 张相同 + 1 对子 | **5**       |              |
|              | **四条**   | 4 张点数相同      | **8**       |      |
|              | **同花顺** | 5 张连续且同花    | **11**      |      |

### 卡片顺序
3 4 5 6 7 8 9 10 J Q K A 2

### 出牌规则
- 允许打出任意手牌组合。
- 若无法组成有效牌型，视为**【杂牌】**，攻防力为 0。此操作消耗回合，主要用于调整手牌结构。
- 若组合包含多个有效牌型，按**倍率最大**的计算。

---

## 3. 战斗机制

### 伤害结算公式
- **攻击**: `基础攻击力 × 牌型倍率`
- **防御**: `基础防御力 × 牌型倍率`
- **最终伤害**: `max(攻击 - 防御, 0) + 真实伤害`

### 进攻同花 Buff (元素机制)
进攻时，若打出的牌中包含 **3 张以上同花色** 牌，触发额外效果。
杂牌纳入进攻同花 Buff计算。

- **强度计算**: `强度 = 同花色牌数量 - 2`

| 花色       | 效果类型      | 效果描述                                              
| :--------- | :------------ | :---------------------------------------------------- |
| **方片 ♦** | **护盾**      | 增加 `强度` 点护盾。                            |
| **黑桃 ♠** | **真伤**      | 造成 `强度` 点真实伤害，穿透防御。              |      |
| **红桃 ♥** | **回复/净化**      | 回复 `强度` 点生命，并消除等量层数的负面 Buff。 |
| **梅花 ♣** | **中毒** | 施加 `强度` 层中毒。                            |

### 状态效果
- **中毒**: 回合结束时，造成等同于当前层数的伤害。然后层数 - 1。
- **护盾**: 受到伤害时，优先扣除护盾值，再扣除生命值。

---

## 4. 游戏流程与行动

### 连击系统 (Combo)
当进攻者打出 **高级牌型**（>3 张）时，触发连击状态。

- **效果**: 进攻方可以继续出牌进攻。
- **限制**: 连击阶段 **禁止出单张**。
- **结束**: 玩家选择弃牌或无牌可出时，退出连击模式。

### 完全防御
当防御方防御数值 > 进攻方进攻数值时，溢出的防御值将转换为护盾。

### 玩家行动选项
#### 攻击方 (Attacker)
1.  **攻击**: 打出牌型造成伤害（可能触发连击）。
2.  **弃牌**: 放弃攻击，丢弃最多 5 张牌，从牌堆抽取等量新牌，结束回合。
3.  **跳过**: (仅限特定情况) 不行动。

#### 防御方 (Defender)
1.  **防御**: 打出牌型抵挡伤害。

### 典型回合流程 (案例)
**[第 1 轮] A 攻 B 防**

1.  **A 进攻**: 打出【顺子】(高级牌型)。
2.  **B 防御**: 打出任意牌防御。
3.  **结算**: 计算伤害，若 B 存活，进入连击判断。
4.  **A 连击**: A 触发连击，再次打出【对子】(基础牌型)。
5.  **B 防御**: B 再次防御。
6.  **结算**: 计算伤害。
7.  **回合结束**: 攻守互换，双方补牌至手牌上限。

**[第 2 轮] B 攻 A 防**

1.  **B 行动**: 手牌不佳，选择【弃牌】4 张。
2.  **抽牌**: B 抽取 4 张新牌。
3.  **回合结束**: 攻守互换。
